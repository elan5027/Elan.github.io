---
layout: post
bigtitle:  "팀프로젝트 채팅 기능 구현"
subtitle:   "project"
categories:
    - project
    - team
tags:
  - project
  - team
comments: true
published: true
---
# 팀프로젝트 채팅 기능 구현

ASGi를 통한 실시간 채팅의 구현을 하게 되었다.

일반적인 채팅의 구현과 달리 우리는 JWT를 사용하기 때문에

Websocket 통신 시 유저의 Access 토큰을 통하여 인증 절차가 필요하다고 판단햇다.



1. 모델의 구현
채팅의 모델은 다음과 같이 구성햇다.
- 채팅방의 구분을 위한 Room 모델
- 채팅방 안의 유저를 생성하기 위한 RoomJoin 모델
- 채팅방 안의 메세지를 생성하기 위한 Message 모델 

2. 인증 절차를 진행하기 위한 미들웨어 구현
- token에는 user_id와 email, is_admin 이라는 필드가 추가되어 있다.
- 미들웨어에서 1차적으로 토큰을 검증
- 토큰에 user_id의 존재 유무 확인
- user_id 를 통해 User를 가져오는 것으로 유저를 검증한다.
- 해당 유저 정보를 통해 소켓 연결.

3. consumers 구현

consumers 부분은 딱히 수정할 필요성을 느끼지 못하여 기본적인 골조에서
혹시모를 이후의 수정의 편의성을 위해 구조화만 진행하였다.

4. 채팅방의 생성 및 관리를 위한 Views 구현
현재 우리 사이트는 채팅을 관리자와의 실시간 상담 기능으로 사용하고 있다.
전체적으로 3가지의 기능을 임의로 구현하였다.
- 1. 현재 로그인한 유저가 속하여 있는 채팅방을 조회하는 기능.
- 2. 현재 로그인한 유저를 기준으로 Admin과의 채팅방을 생성하는 기능
- 3. 특정 채팅방에 대해 정보를 조회하는 기능.


5. 배포 시 주의 할 점.
- 배포 시 ASGI 통신을 위해 gunicorn 대신 daphne 를 통해 올려야된다. gunicorn 을 사용하려면 uvicorn을 사용하자.
- ngnix의 경로 설정을 통해 웹소켓을 위한 경로를 별도로 열어 두어야 한다.






